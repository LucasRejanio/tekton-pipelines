apiVersion: tekton.dev/v1beta1
kind: Task
metadata:
  name: build-image
  namespace: tekton-pipelines
spec:
  steps:
    - name: build
      image: docker:dind
      env:
      # Connect to the sidecar over TCP, with TLS.
      - name: DOCKER_HOST
        value: tcp://localhost:2376
      # Verify TLS.
      - name: DOCKER_TLS_VERIFY
        value: '1'
      # Use the certs generated by the sidecar daemon.
      - name: DOCKER_CERT_PATH
        value: /certs/client
      securityContext:
        privileged: true
      workingDir: /workspaces/$(workspaces.repository)
      script: |

        #!/bin/bash

        echo "----------- Gerando imagem da aplicação -----------"
        docker build -t tekton .

  workspaces:
    - name: repository
